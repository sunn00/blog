(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{594:function(t,a,s){"use strict";s.r(a);var n=s(9),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("blockquote",[s("p",[t._v("html2canvas是一个非常流行的前端开源工具，在GitHub上已有25k+的stars。在项目开发中，我们经常使用他来实现一些生成截图的需求。html2canvas的主要功能是将前端页面中的HTML按照一定规则绘制在Canvas中，之后我们可以对Canvas进行读取和导出，从而达到类似于截图的效果。")])]),t._v(" "),s("h2",{attrs:{id:"how-to-use"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#how-to-use"}},[t._v("#")]),t._v(" How to use")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("安装")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" i html2canvas\nor\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" html2canvas\n")])])])]),t._v(" "),s("li",[s("p",[t._v("引入")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" html2canvas "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'html2canvas'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("截图并下载")]),t._v(" "),s("p",[t._v("html2canvas就是一个函数，在页面渲染完成之后直接调用即可。")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("视图渲染完成的事件：\n1. Angular的ngAfterViewInit方法\n2. React的componentDidMount方法\n3. Vue的mounted方法\n")])])]),s("p",[t._v("可以只传一个参数，就是你要截图的DOM元素，该函数返回一个Promise对象，在它的then方法中可以获取到绘制好的canvas对象，通过调用canvas对象的toDataURL方法就可以将其转换成图片。")]),t._v(" "),s("p",[t._v("拿到图片的URL之后，我们可以")]),t._v(" "),s("ol",[s("li",[t._v("将其放到"),s("code",[t._v("<img>")]),t._v("标签的src属性中，让其显示在网页中；")]),t._v(" "),s("li",[t._v("也可以将其放到"),s("code",[t._v("<a>")]),t._v("标签的href属性中，将该图片下载到本地磁盘中。")])]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("html2canvas")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("querySelector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.main'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("canvas")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" link "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'a'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建一个超链接对象实例")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" event "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MouseEvent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'click'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建一个鼠标事件的实例")]),t._v("\n  link"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("download "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Button.png'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置要下载的图片的名称")]),t._v("\n  link"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("href "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" canvas"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("toDataURL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将图片的URL设置到超链接的href中")]),t._v("\n  link"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("dispatchEvent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 触发超链接的点击事件")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])])])]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参数"}},[t._v("#")]),t._v(" 参数")]),t._v(" "),s("div",{staticClass:"language-typescript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-typescript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("html2canvas")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("element"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" HTMLElement"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" options"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" object"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("Promise")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("HTMLCanvasElement"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),s("p",[t._v("该函数的第二个参数为"),s("code",[t._v("options")]),t._v("，"),s("code",[t._v("options")]),t._v("对象可选的值如下：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[s("strong",[t._v("Name")])]),t._v(" "),s("th",[s("strong",[t._v("Default")])]),t._v(" "),s("th",[s("strong",[t._v("Description")])])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("allowTaint")]),t._v(" "),s("td",[s("code",[t._v("false")])]),t._v(" "),s("td",[t._v("是否允许跨域图像污染画布")])]),t._v(" "),s("tr",[s("td",[t._v("backgroundColor")]),t._v(" "),s("td",[s("code",[t._v("#ffffff")])]),t._v(" "),s("td",[t._v("画布背景颜色，如果在DOM中没有指定，设置“null”（透明）")])]),t._v(" "),s("tr",[s("td",[t._v("canvas")]),t._v(" "),s("td",[s("code",[t._v("null")])]),t._v(" "),s("td",[t._v("使用现有的“画布”元素，用来作为绘图的基础")])]),t._v(" "),s("tr",[s("td",[t._v("foreignObjectRendering")]),t._v(" "),s("td",[s("code",[t._v("false")])]),t._v(" "),s("td",[t._v("是否使用ForeignObject渲染（如果浏览器支持的话）")])]),t._v(" "),s("tr",[s("td",[t._v("imageTimeout")]),t._v(" "),s("td",[s("code",[t._v("15000")])]),t._v(" "),s("td",[t._v("加载图像的超时时间(毫秒)，设置为“0”以禁用超时")])]),t._v(" "),s("tr",[s("td",[t._v("ignoreElements")]),t._v(" "),s("td",[s("code",[t._v("(element) => false")])]),t._v(" "),s("td",[t._v("从呈现中移除匹配元素")])]),t._v(" "),s("tr",[s("td",[t._v("logging")]),t._v(" "),s("td",[s("code",[t._v("true")])]),t._v(" "),s("td",[t._v("为调试目的启用日志记录")])]),t._v(" "),s("tr",[s("td",[t._v("onclone")]),t._v(" "),s("td",[s("code",[t._v("null")])]),t._v(" "),s("td",[t._v("回调函数，当文档被克隆以呈现时调用，可以用来修改将要呈现的内容，而不影响原始源文档。")])]),t._v(" "),s("tr",[s("td",[t._v("proxy")]),t._v(" "),s("td",[s("code",[t._v("null")])]),t._v(" "),s("td",[t._v("用来加载跨域图片的代理URL，如果设置为空（默认），跨域图片将不会被加载")])]),t._v(" "),s("tr",[s("td",[t._v("removeContainer")]),t._v(" "),s("td",[s("code",[t._v("true")])]),t._v(" "),s("td",[t._v("是否清除html2canvas临时创建的克隆DOM元素")])]),t._v(" "),s("tr",[s("td",[t._v("scale")]),t._v(" "),s("td",[s("code",[t._v("window.devicePixelRatio")])]),t._v(" "),s("td",[t._v("用于渲染的缩放比例，默认为浏览器设备像素比")])]),t._v(" "),s("tr",[s("td",[t._v("useCORS")]),t._v(" "),s("td",[s("code",[t._v("false")])]),t._v(" "),s("td",[t._v("是否尝试使用CORS从服务器加载图像")])]),t._v(" "),s("tr",[s("td",[t._v("width")]),t._v(" "),s("td",[s("code",[t._v("Element")]),t._v(" width")]),t._v(" "),s("td",[s("code",[t._v("canvas")]),t._v("的宽度")])]),t._v(" "),s("tr",[s("td",[t._v("height")]),t._v(" "),s("td",[s("code",[t._v("Element")]),t._v(" height")]),t._v(" "),s("td",[s("code",[t._v("canvas")]),t._v("的高度")])]),t._v(" "),s("tr",[s("td",[t._v("x")]),t._v(" "),s("td",[s("code",[t._v("Element")]),t._v(" x-offset")]),t._v(" "),s("td",[s("code",[t._v("canvas")]),t._v("的x轴位置")])]),t._v(" "),s("tr",[s("td",[t._v("y")]),t._v(" "),s("td",[s("code",[t._v("Element")]),t._v(" y-offset")]),t._v(" "),s("td",[s("code",[t._v("canvas")]),t._v("的y轴位置")])]),t._v(" "),s("tr",[s("td",[t._v("scrollX")]),t._v(" "),s("td",[s("code",[t._v("Element")]),t._v(" scrollX")]),t._v(" "),s("td",[t._v("渲染元素时使用的x轴位置(例如，如果元素使用"),s("code",[t._v("position: fixed")]),t._v(")")])]),t._v(" "),s("tr",[s("td",[t._v("scrollY")]),t._v(" "),s("td",[s("code",[t._v("Element")]),t._v(" scrollY")]),t._v(" "),s("td",[t._v("渲染元素时使用的y轴位置(例如，如果元素使用"),s("code",[t._v("position: fixed")]),t._v(")")])]),t._v(" "),s("tr",[s("td",[t._v("windowWidth")]),t._v(" "),s("td",[s("code",[t._v("Window.innerWidth")])]),t._v(" "),s("td",[t._v("渲染元素时使用的窗口宽度，这可能会影响诸如媒体查询之类的事情")])]),t._v(" "),s("tr",[s("td",[t._v("windowHeight")]),t._v(" "),s("td",[s("code",[t._v("Window.innerHeight")])]),t._v(" "),s("td",[t._v("渲染元素时使用的窗口高度，这可能会影响诸如媒体查询之类的事情")])])])]),t._v(" "),s("blockquote",[s("p",[t._v("options有一个"),s("code",[t._v("ignoreElements")]),t._v("参数可以用来忽略某些元素，从渲染过程中移除，除了设置该参数外，还有一种忽略元素的方法，就是在需要忽略的元素上增加"),s("code",[t._v("data-html2canvas-ignore")]),t._v("属性。")])]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"基本原理概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基本原理概述"}},[t._v("#")]),t._v(" 基本原理概述")]),t._v(" "),s("p",[t._v("html2canvas的基本原理是对页面中已渲染的DOM元素的结构与样式信息进行解析，并且根据这些信息生成层叠结构，最后根据这些层叠结构按照顺序一层一层地在Canvas上绘制各个元素。")]),t._v(" "),s("p",[t._v("我将这一过程分为以下三个阶段")]),t._v(" "),s("ul",[s("li",[t._v("解析原始DOM为"),s("code",[t._v("ElementContainer")]),t._v("（与原始DOM层级结构类似）")]),t._v(" "),s("li",[t._v("解析"),s("code",[t._v("ElementContainer")]),t._v("为一组树状的层叠上下文（stackingContext，与原始DOM层级结构区别较大）")]),t._v(" "),s("li",[t._v("从最上层的层叠上下文开始，"),s("strong",[t._v("递归地")]),t._v("对层叠上下文各层中的"),s("strong",[t._v("节点和子层叠上下文")]),t._v("进行解析并按顺序绘制在Canvas上，针对要绘制的每个节点，主要有以下两个过程：\n"),s("ul",[s("li",[t._v("解析节点的”效果“（变换、剪切、透明度）并应用于Canvas上")]),t._v(" "),s("li",[t._v("在Canvas上绘制")])])])]),t._v(" "),s("hr")])}),[],!1,null,null,null);a.default=e.exports}}]);