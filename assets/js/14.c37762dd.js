(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{597:function(n,t,e){"use strict";e.r(t);var a=e(9),s=Object(a.a)({},(function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[e("blockquote",[e("p",[n._v("跟着MDN中的nodejs入门，使用express框架搭建一个本地图书馆的小项目，在项目中可以学习到项目结构、路由模块搭建、mongoDB数据库的使用和pug模板。先跟着教程走一遍流程，再重新自己总结知识点。")])]),n._v(" "),e("h2",{attrs:{id:"async"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#async"}},[n._v("#")]),n._v(" Async")]),n._v(" "),e("blockquote",[e("p",[n._v("在使用nodejs时，我们常需要等到数据返回才会继续渲染模板，如果控制器只需要一个异步操作，那我们可以简单的使用回调函数来实现，而当控制器需要执行多个异步操作时，回调函数就不够看了，async模块可以实现并行执行所有请求，然后在所有查询完成后执行单个回调。")])]),n._v(" "),e("h4",{attrs:{id:"async-parallel"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#async-parallel"}},[n._v("#")]),n._v(" "),e("code",[n._v("async.parallel()")])]),n._v(" "),e("p",[n._v("用于并行运行多个异步操作。")]),n._v(" "),e("p",[n._v("第一个参数为要运行的异步操作函数的集合（数组、对象、可迭代集合）。每个函数都传递一个回调函数callback(err, result) ，它必须在完成时调用错误err（可以为null）和可选的结果值。")]),n._v(" "),e("p",[n._v("第二个可选参数是一个回调，它将在第一个参数中的所有函数完成时运行。回调的调用，是使用错误参数和包含各个异步操作结果的结果集合。结果集合与第一个参数的类型相同。如果任何并行函数报告错误，则提前调用回调（具有错误值）。数组顺序结果，将与声明函数的原始顺序匹配 - 而不是它们完成的顺序")]),n._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[n._v("async"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[n._v("parallel")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),n._v("\n  "),e("span",{pre:!0,attrs:{class:"token function-variable function"}},[n._v("one")]),e("span",{pre:!0,attrs:{class:"token operator"}},[n._v(":")]),n._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("function")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[n._v("callback")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),n._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[n._v("...")]),n._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v("\n  "),e("span",{pre:!0,attrs:{class:"token function-variable function"}},[n._v("two")]),e("span",{pre:!0,attrs:{class:"token operator"}},[n._v(":")]),n._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("function")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[n._v("callback")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),n._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[n._v("...")]),n._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[n._v("...")]),n._v("\n  "),e("span",{pre:!0,attrs:{class:"token function-variable function"}},[n._v("something_else")]),e("span",{pre:!0,attrs:{class:"token operator"}},[n._v(":")]),n._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("function")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[n._v("callback")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),n._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[n._v("...")]),n._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),n._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[n._v("// optional callback")]),n._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("function")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[n._v("err"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v(" results")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),n._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[n._v("// 'results' is now equal to: {one: 1, two: 2, ..., something_else: some_value}")]),n._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),n._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n")])])]),e("h4",{attrs:{id:"async-series"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#async-series"}},[n._v("#")]),n._v(" "),e("code",[n._v("async.series()")])]),n._v(" "),e("p",[n._v("用于按顺序运行多个异步操作，后续函数不依赖于先前函数的输出。它本质上是声明的，并且行为与"),e("code",[n._v("async.parallel()")]),n._v(".相同。")]),n._v(" "),e("blockquote",[e("p",[n._v("⚠️ECMAScript（JavaScript）语言规范指出，对象的枚举顺序是未定义的，因此可能不会按照在所有平台上指定它们的顺序，调用这些函数。如果顺序真的很重要，那么你应该传递一个数组而不是一个对象，如下所示。")])]),n._v(" "),e("h4",{attrs:{id:"async-waterfall"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#async-waterfall"}},[n._v("#")]),n._v(" "),e("code",[n._v("async.waterfall()")])]),n._v(" "),e("p",[n._v("用于在每个操作依赖于前一个操作的结果时,依次运行多个异步操作。")]),n._v(" "),e("p",[n._v("每个异步函数调用的回调，包含第一个参数的"),e("code",[n._v("null")]),n._v("，与后续参数里的结果。该序列中的每个函数，都将前一个回调的结果参数，作为第一个参数，然后是回调函数。")]),n._v(" "),e("p",[n._v("完成所有操作后，将使用上一操作的结果，调用最终回调。当您参考下面的代码片段时，这种工作方式会更加明确")]),n._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[n._v("async"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[n._v("waterfall")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("[")]),n._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("function")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[n._v("callback")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),n._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[n._v("callback")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("null")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[n._v("'one'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[n._v("'two'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("function")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[n._v("arg1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v(" arg2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v(" callback")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),n._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[n._v("// arg1 now equals 'one' and arg2 now equals 'two' ")]),n._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[n._v("callback")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("null")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[n._v("'three'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("function")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[n._v("arg1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v(" callback")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),n._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[n._v("// arg1 now equals 'three'")]),n._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[n._v("callback")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("null")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[n._v("'done'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),n._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("function")]),n._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[n._v("err"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v(" result")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),n._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[n._v("// result now equals 'done'")]),n._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),n._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n")])])]),e("h2",{attrs:{id:"pug模板"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#pug模板"}},[n._v("#")]),n._v(" Pug模板")]),n._v(" "),e("p",[n._v("该文件映射典型 HTML 文件的结构，其中（几乎）每一行中的第一个单词是 HTML 元素，并且缩进用于指示嵌套元素。")]),n._v(" "),e("p",[n._v("元素属性被定义在其关联元素之后的括号中。在括号内，属性定义在以逗号或空格分隔的属性名称和属性值对的列表中，例如：")]),n._v(" "),e("ul",[e("li",[e("code",[n._v("script(type='text/javascript')")]),n._v(", "),e("code",[n._v("link(rel='stylesheet', href='/stylesheets/style.css')")])]),n._v(" "),e("li",[e("code",[n._v("meta(name='viewport' content='width=device-width initial-scale=1')")])])]),n._v(" "),e("p",[n._v("所有属性的值都被转义（例如 “"),e("code",[n._v(">")]),n._v("” 等字符转换为 HTML 代码等效项，如“"),e("code",[n._v(">")]),n._v("”），以防止注入 JavaScript 或跨站点脚本攻击。")]),n._v(" "),e("p",[n._v("如果标记后跟着等号，则以下文本将被视为 JavaScript 表达式。")]),n._v(" "),e("p",[n._v("如果标记后面没有等号，则将内容视为纯文本。在纯文本中，您可以使用"),e("code",[n._v("#{}")]),n._v(" 和"),e("code",[n._v("!{}")]),n._v("语法，插入转义和非转义数据")]),n._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[n._v("p This is a line "),e("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("with")]),n._v(" #"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("[")]),n._v("em some emphasis"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("]")]),n._v(" and #"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("[")]),n._v("strong strong text"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("]")]),n._v(" markup"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(".")]),n._v("\np This line has an un"),e("span",{pre:!0,attrs:{class:"token operator"}},[n._v("-")]),n._v("escaped string"),e("span",{pre:!0,attrs:{class:"token operator"}},[n._v(":")]),n._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[n._v("!")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),e("span",{pre:!0,attrs:{class:"token string"}},[n._v("'<em> is emphasised</em>'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v(" an escaped string"),e("span",{pre:!0,attrs:{class:"token operator"}},[n._v(":")]),n._v(" #"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),e("span",{pre:!0,attrs:{class:"token string"}},[n._v("'<em> is not emphasised</em>'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v(" and escaped variables"),e("span",{pre:!0,attrs:{class:"token operator"}},[n._v(":")]),n._v(" #"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),n._v("title"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(".")]),n._v("\n")])])]),e("blockquote",[e("p",[n._v("您几乎总是希望转义来自用户的数据（通过**"),e("code",[n._v("#{}")]),n._v("**语法）。可信任的数据（例如，生成的记录计数等）可以不先转义就显示。")])]),n._v(" "),e("p",[n._v("您可以在行的开头使用管道（“"),e("strong",[n._v("|")]),n._v("”）字符来表示“"),e("a",{attrs:{href:"https://pugjs.org/language/plain-text.html",target:"_blank",rel:"noopener noreferrer"}},[n._v("纯文本"),e("OutboundLink")],1),n._v("”。例如，下面显示的附加文本，将显示在与前一个锚点相同的行上，但不会链接。")]),n._v(" "),e("div",{staticClass:"language-html extra-class"},[e("pre",{pre:!0,attrs:{class:"language-html"}},[e("code",[n._v("a(href='http://someurl/') Link text\n| Plain text\n")])])]),e("p",[n._v("Pug 允许您使用"),e("code",[n._v("if")]),n._v(", "),e("code",[n._v("else")]),n._v(" , "),e("code",[n._v("else if")]),n._v(" 和 "),e("code",[n._v("unless")]),n._v("执行条件操作 - 例如：")]),n._v(" "),e("div",{staticClass:"language-html extra-class"},[e("pre",{pre:!0,attrs:{class:"language-html"}},[e("code",[n._v('if title\n  p A variable named "title" exists\nelse\n  p A variable named "title" does not exist\n')])])]),e("p",[n._v("以使用"),e("code",[n._v("each-in")]),n._v(" 或 "),e("code",[n._v("while")]),n._v("语法执行循环/迭代操作。在下面的代码片段中，我们循环遍历数组，以显示变量列表（注意，使用 'li =' 来评估 “val” ，以作为下面的变量。）迭代的值也可以传递给模板作为变量！")]),n._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[n._v("ul\n  each val "),e("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("in")]),n._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[n._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[n._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[n._v("3")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[n._v("4")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[n._v("5")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("]")]),n._v("\n    li"),e("span",{pre:!0,attrs:{class:"token operator"}},[n._v("=")]),n._v(" val\n")])])]),e("p",[n._v("块标记"),e("code",[n._v("block")]),n._v("用于标记 “可在派生模板中替换的内容部分“（如果未重新定义块，则使用其在基类中的实现）。"),e("code",[n._v("extends")]),n._v("标记，标识要使用的基本模板，然后我们使用 "),e("code",[n._v("block *section_name*")]),n._v(" ，来指示我们将覆盖的部分的新内容。")]),n._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[n._v("// extends标记，标识要使用的基本模板，然后我们使用 block section_name ，来指示我们将覆盖的部分的新内容。")]),n._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("extends")]),n._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[n._v("layout")]),n._v("\n\nblock content\n  h1"),e("span",{pre:!0,attrs:{class:"token operator"}},[n._v("=")]),n._v(" title\n\n  ul\n  each book "),e("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("in")]),n._v(" book_list\n    li\n      "),e("span",{pre:!0,attrs:{class:"token function"}},[n._v("a")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("href"),e("span",{pre:!0,attrs:{class:"token operator"}},[n._v("=")]),n._v("book"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(".")]),n._v("url"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v(" #"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),n._v("book"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(".")]),n._v("title"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),n._v("\n      "),e("span",{pre:!0,attrs:{class:"token operator"}},[n._v("|")]),n._v("  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("#"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),n._v("book"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(".")]),n._v("author"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(".")]),n._v("name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("else")]),n._v("\n    li There are no books"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(".")]),n._v("\n")])])]),e("p",[n._v("Item")]),n._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('\n<template>\n  <div\n    class="relative item-title leading-36px hover:bg-[#F0F7FF]"\n    :style="{ \'padding-left\': paddingLeftPx }"\n    :class="{ \'checked-item\': checkedKey === categories.id }"\n  >\n    <holder-outlined\n      v-if="isShowSettingIcon"\n      style="color: #165DFF"\n      class="mover absolute top-11px left-12px cursor-pointer setting-icon"\n    />\n\n    <div class="relative flex justify-between items-center" @click="handleChecked(categories.id)">\n      <caret-down-outlined\n        v-if="categories?.children?.length !== 0"\n        style="color: #C9CDD4"\n        class="absolute top-12px -left-18px text-16px text-[#C9CDD4]"\n        @click.stop="handleExpaned(categories)"\n      />\n\n      <span class="cursor-default">\n        {{ categories.name }}\n        <span class="pl-4px text-[#86909C]">{{ categories.count }}</span>\n      </span>\n\n      <template v-if="isAllGoods">\n        <plus-circle-outlined class="text-16px setting-icon" style="color: #165DFF" />\n      </template>\n\n      <div v-else-if="isShowSettingIcon" class="pr-14px" @click.stop>\n        <plus-circle-outlined class="text-16px setting-icon" style="color: #165DFF" />\n        <a-dropdown :trigger="[\'click\']">\n          <frown-outlined class="ml-4px text-16px setting-icon" style="color: #165DFF" />\n          <template #overlay>\n            <a-menu>\n              <a-menu-item>\n                <a href="javascript:;">置顶</a>\n              </a-menu-item>\n              <a-menu-item>\n                <a href="javascript:;">重命名</a>\n              </a-menu-item>\n              <a-menu-item>\n                <a href="javascript:;">删除</a>\n              </a-menu-item>\n            </a-menu>\n          </template>\n        </a-dropdown>\n      </div>\n    </div>\n  </div>\n</template>\n<script lang="ts" setup>\nimport { includes, isObject } from \'lodash-es\';\nimport { HolderOutlined, CaretDownOutlined, PlusCircleOutlined, FrownOutlined } from \'@ant-design/icons-vue\';\n\n\ntype CategoriesItem = {\n  id: string | number, // 分类Id\n  name: string, // 分类名称\n  count?: string,\n  children?: CategoriesItem[], // 子分类\n}\n\ninterface Props {\n  categories: CategoriesItem,\n  checkedKey: string,\n  expanedKey: Map<string, boolean>,\n  paddingLeftPx: string\n}\n\nconst props = defineProps<Props>()\nconst emit = defineEmits([\'checked\', \'expaned\'])\n\nconst isShowSettingIcon = computed(() => {\n  return !includes([\'1\', \'2\'], props.categories.id)\n})\n\nconst isAllGoods = computed(() => {\n  return props.categories.id === "1"\n})\n\nconst handleChecked = (id: string | number): void => {\n  emit("checked", id)\n}\n\nconst handleExpaned = (categories: CategoriesItem | string): void => {\n  if (isObject(categories)) {\n    emit("expaned", categories.id)\n  } else {\n    emit("expaned", categories)\n  }\n}\n<\/script>\n\n<style lang="less" scoped>\n.checked-item {\n  background-color: #f2f3f5;\n}\n\n.setting-icon {\n  @apply hidden cursor-pointer;\n}\n\n.item-title:hover {\n  .setting-icon {\n    @apply inline-block;\n  }\n}\n</style>\n')])])]),e("p",[n._v("category")]),n._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('<template>\n  <section class="w-204px h-full border border-solid border-[#E5E6EB] rounded-sm">\n    <header class="p-12px pb-0">\n      <h5 class="mb-12px text-16px">商品分类</h5>\n      <a-input\n        v-model:value="searchCategoriesForm.name"\n        class="w-180px"\n        placeholder="搜索分类"\n        @search="onSearch"\n      >\n        <template #suffix>\n          <search-outlined />\n        </template>\n      </a-input>\n    </header>\n    <div class="py-16px">\n      <categories-draggable\n        :categories="categories[0]"\n        :level="0"\n        :checkedKey="checkedKey"\n        :expanedKey="expanedKey"\n        @checked="handleChecked"\n        @expaned="handleExpaned"\n      />\n    </div>\n  </section>\n</template>\n\n<script setup lang=\'ts\'>\nimport draggable from "vuedraggable";\nimport { includes, remove } from \'lodash-es\';\n\nimport { SearchOutlined } from \'@ant-design/icons-vue\';\nimport CategoriesDraggable from \'~/views/goodsManage/GoodsManageCategoriesDraggable.vue\'\n\n\ninterface searchCategoriesForm {\n  name: string\n}\n\nconst searchCategoriesForm = reactive<searchCategoriesForm>({\n  name: ""\n})\n\nconst onSearch = (searchValue: string) => {\n  console.log(\'use value\', searchValue);\n  console.log(\'or use this.value\', searchCategoriesForm.name);\n};\n\ntype CategoriesItem = {\n  id: string | number, // 分类Id\n  name: string, // 分类名称\n  count?: string,\n  children?: CategoriesItem[], // 子分类\n}\n\nconst categories = ref<CategoriesItem[]>([\n  {\n    "id": "1",\n    "name": "全部商品",\n    "count": \'40\',\n    "children": [\n      {\n        "id": "2",\n        "name": "默认分类",\n        "count": \'40\',\n        "children": []\n      },\n      {\n        "id": "3",\n        "name": "会计课程",\n        "count": \'40\',\n        "children": [\n          {\n            "id": "4",\n            "name": "会员",\n            "count": \'40\',\n            "children": []\n          },\n          {\n            "id": "8",\n            "count": \'40\',\n            "name": "会员2",\n            "children": []\n          },\n          {\n            "id": "9",\n            "count": \'40\',\n            "name": "会员3",\n            "children": []\n          }\n        ]\n      },\n      {\n        "id": "5",\n        "count": \'40\',\n        "name": "拖动排序",\n        "children": []\n      },\n      {\n        "id": "6",\n        "count": \'40\',\n        "name": "营销活动",\n        "children": [\n          {\n            "id": "7",\n            "count": \'40\',\n            "name": "打卡活动",\n            "children": []\n          },\n          {\n            "id": "10",\n            "count": \'40\',\n            "name": "打卡活",\n            "children": []\n          },\n          {\n            "id": "11",\n            "count": \'40\',\n            "name": "打卡",\n            "children": []\n          },\n          {\n            "id": "12",\n            "count": \'40\',\n            "name": "打",\n            "children": []\n          },\n        ]\n      }\n    ]\n  }\n])\n\n\nconst checkedKey = ref<string>("1")\nconst expanedKey = reactive(new Map([["1", true]]))\n\nconst handleChecked = (id: string): void => {\n  checkedKey.value = id\n}\n\nconst handleExpaned = (id: string): void => {\n  if (expanedKey.has(id)) {\n    expanedKey.set(id, !expanedKey.get(id))\n  } else {\n    expanedKey.set(id, true)\n  }\n}\n\n<\/script>\n\n<style lang=\'less\' scoped>\n:deep(.ant-input-affix-wrapper) {\n  @apply rounded-sm;\n}\n\n.anticon-caret-down {\n  @apply mr-8px;\n}\n\n:deep(.ant-menu) {\n  .ant-menu-sub.ant-menu-inline {\n    background-color: #fff;\n  }\n\n  .ant-menu-title-content {\n    @apply flex items-center;\n  }\n\n  .ant-menu-submenu-arrow {\n    display: none;\n  }\n}\n</style>\n')])])]),e("p",[n._v("graggable")]),n._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('<template>\n  <ul class="relative text-14px text-[#1D2129] cursor-default">\n    <div\n      class="relative item-title leading-36px hover:bg-[#F0F7FF]"\n      :style="{ \'padding-left\': paddingLeftPx }"\n      :class="{ \'checked-item\': checkedKey === categories.id }"\n    >\n      <holder-outlined\n        style="color: #165DFF"\n        class="mover absolute top-11px left-12px cursor-pointer setting-icon"\n        v-if="isShowSettingIcon"\n      />\n\n      <div class="relative flex justify-between items-center" @click="handleChecked(categories.id)">\n        <caret-down-outlined\n          v-if="categories?.children.length !== 0"\n          style="color: #C9CDD4"\n          class="absolute top-10px -left-18px text-16px text-[#C9CDD4]"\n          :class="{ \'rotate-90\': checkedKey === categories.id }"\n          @click.stop="handleExpaned(categories)"\n        />\n\n        <span class="cursor-default">\n          {{ categories.name }}\n          <span class="pl-4px text-[#86909C]">{{ categories.count }}</span>\n        </span>\n        <template v-if="isAllGoods">\n          <plus-circle-outlined class="pr-14px text-16px cursor-pointer" style="color: #165DFF" />\n        </template>\n\n        <div v-else-if="isShowSettingIcon" class="pr-14px" @click.stop>\n          <plus-circle-outlined class="text-16px setting-icon" style="color: #165DFF" />\n          <a-dropdown :trigger="[\'click\']">\n            <frown-outlined class="ml-4px text-16px setting-icon" style="color: #165DFF" />\n            <template #overlay>\n              <a-menu>\n                <a-menu-item>\n                  <span>置顶</span>\n                </a-menu-item>\n                <a-menu-item>\n                  <span>重命名</span>\n                </a-menu-item>\n                <a-menu-item>\n                  <span>删除</span>\n                </a-menu-item>\n              </a-menu>\n            </template>\n          </a-dropdown>\n        </div>\n      </div>\n    </div>\n\n    <draggable\n      handle=".mover"\n      v-model="categories.children"\n      tag="li"\n      :group="categories.name"\n      item-key="id"\n      animation="300"\n      :component-data="{ name: \'fade\' }"\n      class="transition-opacity duration-200"\n      :class="{ \'transfrom max-h-screen\': expanedKey.get(categories.id), \'h-0 opacity-0\': !expanedKey.get(categories.id) }"\n      :move="onMoveCallback"\n    >\n      <template #item="{ element }">\n        <categories-draggable\n          :categories="element"\n          :level="currentLevel"\n          :checkedKey="checkedKey"\n          :expanedKey="expanedKey"\n          @checked="handleChecked"\n          @expaned="handleExpaned"\n        />\n      </template>\n    </draggable>\n  </ul>\n</template>\n<script lang="ts" setup>\nimport draggable from "vuedraggable";\nimport { HolderOutlined, CaretDownOutlined, PlusCircleOutlined, FrownOutlined } from \'@ant-design/icons-vue\';\n\nimport CategoriesDraggable from \'~/views/goodsManage/GoodsManageCategoriesDraggable.vue\'\nimport { includes, isObject } from \'lodash-es\';\n\ntype CategoryItem = {\n  id: string | number, // 分类Id\n  name: string, // 分类名称\n  count?: string,\n  children: CategoryItem[] | [], // 子分类\n}\n\ninterface Props {\n  categories: CategoryItem,\n  level: number,\n  checkedKey: string,\n  expanedKey: Map<string, boolean>\n}\n\nconst props = defineProps<Props>()\n\nconst emit = defineEmits([\'checked\', \'expaned\'])\n\n\nconst handleChecked = (id: string): void => {\n  emit("checked", id)\n}\n\nconst handleExpaned = (categories: CategoryItem | string): void => {\n  if (isObject(categories)) {\n    emit("expaned", categories.id)\n  } else {\n    emit("expaned", categories)\n  }\n}\n\nconst currentLevel = computed(() => {\n  console.log(props.level);\n  return props.level + 1\n})\n\nconst paddingLeftPx = computed(() => {\n  return props.level ? `${14 * props.level + 30}px` : \'30px\'\n})\n\nconst isShowSettingIcon = computed(() => {\n  return !includes([\'1\', \'2\'], props.categories.id)\n})\n\nconst isAllGoods = computed(() => {\n  return props.categories.id === "1"\n})\n\nconst onMoveCallback = (evt: any, originalEvent: any) => {\n  if (evt.relatedContext.element.name == \'默认分类\') return false;\n  return true;\n}\n\n\n<\/script>\n\n<style  scoped>\n.checked-item {\n  background-color: #f2f3f5;\n}\n\n.setting-icon {\n  @apply hidden cursor-pointer;\n}\n\n.item-title:hover .setting-icon {\n  @apply inline-block;\n}\n\n.ant-dropdown-menu-item {\n  @apply px-8px;\n}\n.ant-dropdown-menu-title-content > span {\n  @apply text-[#165DFF];\n}\n</style>\n')])])])])}),[],!1,null,null,null);t.default=s.exports}}]);